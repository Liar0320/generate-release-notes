name: Test Local Action

on: [push, pull_request]

jobs:
  test:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest]
    name: Test on ${{ matrix.os }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Generate Release Notes
        uses: ./
        id: release

      - name: Display pure changelog from output
        run: |
          echo "=== 纯 Changelog 输出 ==="
          echo "${{ steps.release.outputs.changelog }}"

      - name: Display complete release notes from output
        run: |
          echo "=== 完整 Release Notes 输出 ==="
          echo "${{ steps.release.outputs.release-notes }}"

      - name: Generate Release Notes to file
        uses: ./
        id: release_file
        with:
          output-file: RELEASE_NOTES.md

      - name: Display saved file
        run: |
          echo "=== 从文件读取 Release Notes ==="
          cat RELEASE_NOTES.md

      - name: Test tag comparison mode
        uses: ./
        id: release_tag
        with:
          compare-mode: tag

      - name: Display tag comparison result
        run: |
          echo "=== 标签比较模式输出 ==="
          echo "当前标签: ${{ steps.release_tag.outputs.current-tag }}"
          echo "上一标签: ${{ steps.release_tag.outputs.previous-tag }}"
          echo "${{ steps.release_tag.outputs.release-notes }}"
