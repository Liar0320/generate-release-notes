name: Test with WeCom Notify

on:
  workflow_dispatch:
    inputs:
      dry_run:
        description: 'Dry run mode (skip actual WeCom request)'
        default: 'true'
        type: choice
        options:
          - 'true'
          - 'false'

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Generate Release Notes
        uses: ./
        id: release
        with:
          output-file: RELEASE_NOTES.md
          base-branch: main

      - name: Display generated Release Notes
        run: |
          echo "=== 生成的 Release Notes 内容 ==="
          cat RELEASE_NOTES.md

      - name: Send to WeCom
        uses: Liar0320/wecom-notify@v1.0.0
        with:
          body_path: RELEASE_NOTES.md
          robots_key: ${{ secrets.WECOM_ROBOTS_KEY }}
          dry_run: ${{ github.event.inputs.dry_run }}
